<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>漫画阅读器 - 基于笒鬼鬼API</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        :root {
            --primary-color: #ff6b6b;
            --secondary-color: #4ecdc4;
            --background-color: #f5f7fa;
            --card-color: #ffffff;
            --text-color: #333333;
            --text-secondary: #666666;
            --border-color: #e1e5e9;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        body.dark-mode {
            --background-color: #1a1a1a;
            --card-color: #2d2d2d;
            --text-color: #e0e0e0;
            --text-secondary: #aaaaaa;
            --border-color: #444444;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            position: relative;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .search-container {
            margin: 20px 0;
            display: flex;
            justify-content: center;
        }
        
        .search-box {
            display: flex;
            width: 100%;
            max-width: 500px;
            box-shadow: var(--shadow);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .search-input {
            flex: 1;
            padding: 12px 15px;
            border: none;
            outline: none;
            font-size: 1rem;
            background: var(--card-color);
            color: var(--text-color);
        }
        
        .search-button {
            padding: 0 20px;
            background: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .search-button:hover {
            background: #ff5252;
        }
        
        .comic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .comic-card {
            background: var(--card-color);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .comic-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        
        .comic-cover {
            width: 100%;
            height: 250px;
            object-fit: cover;
        }
        
        .comic-info {
            padding: 15px;
        }
        
        .comic-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 5px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        
        .comic-author {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .comic-type {
            color: var(--secondary-color);
            font-size: 0.8rem;
            margin-bottom: 5px;
        }
        
        .comic-intro {
            font-size: 0.85rem;
            color: var(--text-secondary);
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
        }
        
        .reader-container {
            display: none;
            background: var(--card-color);
            border-radius: 8px;
            padding: 25px;
            box-shadow: var(--shadow);
            min-height: 500px;
            position: relative;
        }
        
        .comic-detail {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .detail-header {
            display: flex;
            gap: 20px;
        }
        
        .detail-cover {
            width: 200px;
            height: 280px;
            object-fit: cover;
            border-radius: 8px;
        }
        
        .detail-info {
            flex: 1;
        }
        
        .detail-title {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }
        
        .detail-meta {
            color: var(--text-secondary);
            margin-bottom: 15px;
        }
        
        .detail-intro {
            line-height: 1.8;
        }
        
        .chapter-list {
            margin-top: 20px;
        }
        
        .chapter-list h3 {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .chapter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
        }
        
        .chapter-item {
            background: var(--background-color);
            padding: 12px;
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .chapter-item:hover {
            background: var(--primary-color);
            color: white;
        }
        
        .comic-reader {
            display: none;
            flex-direction: column;
            gap: 20px;
        }
        
        .reader-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .reader-title {
            font-size: 1.5rem;
        }
        
        .reader-controls {
            display: flex;
            gap: 10px;
        }
        
        .reader-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .comic-page {
            max-width: 100%;
            max-height: 70vh;
            object-fit: contain;
        }
        
        .page-navigation {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        button {
            padding: 10px 20px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
            font-size: 1rem;
        }
        
        button:hover {
            background: #ff5252;
        }
        
        button:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
        }
        
        .back-button {
            background: var(--secondary-color);
        }
        
        .back-button:hover {
            background: #3db8af;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            font-size: 1.2rem;
        }
        
        .error {
            text-align: center;
            padding: 20px;
            color: var(--primary-color);
            font-size: 1.2rem;
        }
        
        .settings {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--card-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow);
            cursor: pointer;
            z-index: 100;
        }
        
        .settings-panel {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: var(--card-color);
            border-radius: 8px;
            padding: 15px;
            box-shadow: var(--shadow);
            display: none;
            z-index: 100;
            width: 200px;
        }
        
        .settings-panel h3 {
            margin-bottom: 15px;
            text-align: center;
        }
        
        .setting-option {
            margin-bottom: 15px;
        }
        
        .setting-option label {
            display: block;
            margin-bottom: 5px;
        }
        
        select {
            width: 100%;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            background: var(--card-color);
            color: var(--text-color);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .comic-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .detail-header {
                flex-direction: column;
            }
            
            .detail-cover {
                width: 100%;
                height: auto;
                max-height: 400px;
            }
            
            .chapter-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
        }
        
        @media (max-width: 480px) {
            .comic-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .chapter-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-book-open"></i> 漫画阅读器</h1>
            <p>基于笒鬼鬼API的免费漫画阅读平台</p>
            
            <div class="search-container">
                <div class="search-box">
                    <input type="text" class="search-input" id="searchInput" placeholder="搜索漫画...">
                    <button class="search-button" id="searchButton"><i class="fas fa-search"></i></button>
                </div>
            </div>
        </header>
        
        <div class="comic-grid" id="comicGrid">
            <!-- 漫画列表将通过JavaScript动态生成 -->
        </div>
        
        <div class="reader-container" id="readerContainer">
            <div class="comic-detail" id="comicDetail">
                <!-- 漫画详情将通过JavaScript动态生成 -->
            </div>
            
            <div class="comic-reader" id="comicReader">
                <!-- 漫画阅读器将通过JavaScript动态生成 -->
            </div>
        </div>
        
        <div class="loading" id="loading" style="display: none;">
            <i class="fas fa-spinner fa-spin"></i> 加载中...
        </div>
        
        <div class="error" id="error" style="display: none;">
            <i class="fas fa-exclamation-triangle"></i> 加载失败，请重试
        </div>
    </div>
    
    <div class="settings" id="settingsButton">
        <i class="fas fa-cog"></i>
    </div>
    
    <div class="settings-panel" id="settingsPanel">
        <h3>阅读设置</h3>
        <div class="setting-option">
            <label for="theme">主题</label>
            <select id="theme">
                <option value="light">浅色</option>
                <option value="dark">深色</option>
            </select>
        </div>
    </div>

    <script>
        // API基础URL
        const API_BASE_URL = 'https://api.cenguigui.cn/api/tomato/manhua';
        
        // 当前状态
        let currentState = {
            currentComic: null,
            currentChapter: null,
            currentPage: 0,
            comics: [],
            chapters: [],
            pages: []
        };

        // DOM元素
        const comicGridEl = document.getElementById('comicGrid');
        const readerContainerEl = document.getElementById('readerContainer');
        const comicDetailEl = document.getElementById('comicDetail');
        const comicReaderEl = document.getElementById('comicReader');
        const loadingEl = document.getElementById('loading');
        const errorEl = document.getElementById('error');
        const settingsButton = document.getElementById('settingsButton');
        const settingsPanel = document.getElementById('settingsPanel');
        const themeSelect = document.getElementById('theme');
        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');

        // 初始化
        function init() {
            // 默认加载热门漫画
            searchComics('热门');
            setupEventListeners();
            loadSettings();
        }

        // 搜索漫画
        async function searchComics(keyword) {
            if (!keyword.trim()) {
                showError('请输入搜索关键词');
                return;
            }
            
            showLoading();
            
            try {
                const response = await fetch(`${API_BASE_URL}/api.php?name=${encodeURIComponent(keyword)}&page=1`);
                const data = await response.json();
                
                if (data.code === 200 && data.data) {
                    currentState.comics = data.data;
                    renderComicList();
                    hideLoading();
                } else {
                    throw new Error(data.msg || '搜索失败');
                }
            } catch (error) {
                console.error('搜索漫画失败:', error);
                showError('搜索失败: ' + error.message);
            }
        }

        // 渲染漫画列表
        function renderComicList() {
            comicGridEl.innerHTML = '';
            
            if (currentState.comics.length === 0) {
                comicGridEl.innerHTML = '<div class="error">没有找到相关漫画</div>';
                return;
            }
            
            currentState.comics.forEach(comic => {
                const comicCard = document.createElement('div');
                comicCard.className = 'comic-card';
                comicCard.innerHTML = `
                    <img src="${comic.cover}" alt="${comic.title}" class="comic-cover" onerror="this.src='https://via.placeholder.com/200x280?text=封面加载失败'">
                    <div class="comic-info">
                        <div class="comic-title">${comic.title}</div>
                        <div class="comic-author">${comic.author}</div>
                        <div class="comic-type">${comic.type}</div>
                        <div class="comic-intro">${comic.intro || '暂无简介'}</div>
                    </div>
                `;
                comicCard.addEventListener('click', () => openComic(comic));
                comicGridEl.appendChild(comicCard);
            });
        }

        // 打开漫画详情
        async function openComic(comic) {
            showLoading();
            
            try {
                // 获取漫画章节列表
                const response = await fetch(comic.link);
                const data = await response.json();
                
                if (data.code === 200 && data.data) {
                    currentState.currentComic = comic;
                    currentState.chapters = data.data;
                    renderComicDetail();
                    
                    comicGridEl.style.display = 'none';
                    readerContainerEl.style.display = 'block';
                    comicDetailEl.style.display = 'block';
                    comicReaderEl.style.display = 'none';
                    hideLoading();
                } else {
                    throw new Error(data.msg || '获取章节列表失败');
                }
            } catch (error) {
                console.error('打开漫画失败:', error);
                showError('加载漫画失败: ' + error.message);
            }
        }

        // 渲染漫画详情
        function renderComicDetail() {
            if (!currentState.currentComic) return;
            
            const comic = currentState.currentComic;
            
            comicDetailEl.innerHTML = `
                <div class="detail-header">
                    <img src="${comic.cover}" alt="${comic.title}" class="detail-cover" onerror="this.src='https://via.placeholder.com/200x280?text=封面加载失败'">
                    <div class="detail-info">
                        <h2 class="detail-title">${comic.title}</h2>
                        <div class="detail-meta">
                            <p><strong>作者:</strong> ${comic.author}</p>
                            <p><strong>类型:</strong> ${comic.type}</p>
                        </div>
                        <div class="detail-intro">
                            <p>${comic.intro || '暂无简介'}</p>
                        </div>
                    </div>
                </div>
                <div class="chapter-list">
                    <h3>章节列表</h3>
                    <div class="chapter-grid" id="chapterGrid">
                        <!-- 章节列表将通过JavaScript动态生成 -->
                    </div>
                </div>
                <div class="navigation">
                    <button id="backToList" class="back-button">返回列表</button>
                </div>
            `;
            
            // 渲染章节列表
            const chapterGridEl = document.getElementById('chapterGrid');
            chapterGridEl.innerHTML = '';
            
            currentState.chapters.forEach((chapter, index) => {
                const chapterItem = document.createElement('div');
                chapterItem.className = 'chapter-item';
                chapterItem.textContent = `第${index + 1}章`;
                chapterItem.addEventListener('click', () => openChapter(chapter, index));
                chapterGridEl.appendChild(chapterItem);
            });
            
            // 绑定返回按钮事件
            document.getElementById('backToList').addEventListener('click', backToList);
        }

        // 打开章节
        async function openChapter(chapter, chapterIndex) {
            showLoading();
            
            try {
                // 获取章节图片
                const response = await fetch(`${API_BASE_URL}/api.php?item_id=${chapter.item_id}&type=pic`);
                const data = await response.json();
                
                if (data.code === 200 && data.data) {
                    currentState.currentChapter = chapter;
                    currentState.currentPage = 0;
                    currentState.pages = data.data;
                    renderComicReader();
                    
                    comicDetailEl.style.display = 'none';
                    comicReaderEl.style.display = 'flex';
                    hideLoading();
                } else {
                    throw new Error(data.msg || '获取章节内容失败');
                }
            } catch (error) {
                console.error('打开章节失败:', error);
                showError('加载章节失败: ' + error.message);
            }
        }

        // 渲染漫画阅读器
        function renderComicReader() {
            if (!currentState.currentChapter || currentState.pages.length === 0) return;
            
            comicReaderEl.innerHTML = `
                <div class="reader-header">
                    <h2 class="reader-title">${currentState.currentComic.title} - 第${currentState.currentPage + 1}页</h2>
                    <div class="reader-controls">
                        <button id="prevPage" class="prev-button">上一页</button>
                        <button id="nextPage" class="next-button">下一页</button>
                    </div>
                </div>
                <div class="reader-content">
                    <img src="${currentState.pages[currentState.currentPage]}" alt="第${currentState.currentPage + 1}页" class="comic-page" onerror="this.src='https://via.placeholder.com/800x1200?text=图片加载失败'">
                </div>
                <div class="page-navigation">
                    <button id="backToChapters" class="back-button">返回章节</button>
                </div>
            `;
            
            // 绑定事件
            document.getElementById('prevPage').addEventListener('click', prevPage);
            document.getElementById('nextPage').addEventListener('click', nextPage);
            document.getElementById('backToChapters').addEventListener('click', backToChapters);
            
            // 更新按钮状态
            updatePageButtons();
        }

        // 上一页
        function prevPage() {
            if (currentState.currentPage > 0) {
                currentState.currentPage--;
                renderComicReader();
                scrollToTop();
            }
        }

        // 下一页
        function nextPage() {
            if (currentState.currentPage < currentState.pages.length - 1) {
                currentState.currentPage++;
                renderComicReader();
                scrollToTop();
            }
        }

        // 返回章节列表
        function backToChapters() {
            comicReaderEl.style.display = 'none';
            comicDetailEl.style.display = 'block';
        }

        // 返回列表
        function backToList() {
            readerContainerEl.style.display = 'none';
            comicGridEl.style.display = 'grid';
            currentState.currentComic = null;
            currentState.currentChapter = null;
            currentState.currentPage = 0;
        }

        // 更新页面按钮状态
        function updatePageButtons() {
            const prevBtn = document.getElementById('prevPage');
            const nextBtn = document.getElementById('nextPage');
            
            if (prevBtn) prevBtn.disabled = currentState.currentPage === 0;
            if (nextBtn) nextBtn.disabled = currentState.currentPage === currentState.pages.length - 1;
        }

        // 滚动到顶部
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // 显示加载中
        function showLoading() {
            loadingEl.style.display = 'block';
            errorEl.style.display = 'none';
        }

        // 隐藏加载中
        function hideLoading() {
            loadingEl.style.display = 'none';
        }

        // 显示错误
        function showError(message) {
            loadingEl.style.display = 'none';
            errorEl.style.display = 'block';
            errorEl.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${message}`;
        }

        // 设置事件监听器
        function setupEventListeners() {
            // 搜索功能
            searchButton.addEventListener('click', () => searchComics(searchInput.value));
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    searchComics(searchInput.value);
                }
            });
            
            // 设置面板
            settingsButton.addEventListener('click', toggleSettingsPanel);
            themeSelect.addEventListener('change', updateTheme);
            
            // 点击设置面板外部关闭面板
            document.addEventListener('click', (e) => {
                if (!settingsPanel.contains(e.target) && !settingsButton.contains(e.target)) {
                    settingsPanel.style.display = 'none';
                }
            });
        }

        // 切换设置面板显示
        function toggleSettingsPanel() {
            settingsPanel.style.display = settingsPanel.style.display === 'block' ? 'none' : 'block';
        }

        // 更新主题
        function updateTheme() {
            const theme = themeSelect.value;
            if (theme === 'dark') {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }
            saveSettings();
        }

        // 保存设置
        function saveSettings() {
            const settings = {
                theme: themeSelect.value
            };
            localStorage.setItem('comicReaderSettings', JSON.stringify(settings));
        }

        // 加载设置
        function loadSettings() {
            const savedSettings = localStorage.getItem('comicReaderSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                themeSelect.value = settings.theme;
                updateTheme();
            }
        }

        // 初始化应用
        init();
    </script>
</body>
</html>
